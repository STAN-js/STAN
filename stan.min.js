STAN={compile:function(_template_){for(var ms,result=_template_.toString().replace(/function\s+([\d\w_]+)\s*\(\s*\)\s*{([\S\s]+)}/,"(function $1(){$2})()").replace(/(\w+)(?:\[(['"]?[^\]]*?['"]?)\])?\.(e|b)\s*[\n;}]/g,function(a,b,c,d){return"r+='<"+("b"==d?"":"/")+b+" '+("+(c||'""')+")+'>';"}).replace(/(\w+)(?:\[(['"]?[^\]]*?['"]?)\])?\.(.+)\.(\w+)\s*[\n;}]/g,function(a,b,c,d,e){return b==e?"r+='<"+b+" '+("+(c||'""')+")+'>'+("+d+")+'</"+e+">';":a}).replace(/([\n;{]\s*)(\w+)(\s*[\n;}])/g,"$1r+='<$2/>'$3;");ms=result.match(/partial\([_\w\d\.]+/g);)for(var i=0;i<ms.length;i++){var tn=ms[i].replace("partial(","");result=result.replace(tn,STAN.compile(eval(tn)).replace("})()","})"))}return result},run:function(result,context,escape){function partial(a,b){var c=context;context=b,a(),context=c}var r="",raw=function(a){return r+=a,a};if(escape!==!1){var div=document.createElement("div");div.appendChild(document.createTextNode(JSON.stringify(context))),context=JSON.parse(div.innerHTML)}return eval(result),r}};